<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Alex Jover Morales"><meta name="copyright" content="Alex Jover Morales"><link rel="author" type="text/html" href="https://twitter.com/alexjoverm"><link rel="icon" href="/alex.jpg"><link rel="canonical" content="http://alexjoverm.github.io/2017/09/18/Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest/"><!-- Add to home screen for Android and modern mobile browsers--><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#008aff"><!-- Add to home screen for Safari on iOS--><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="apple-mobile-web-app-title" content="Alex Jover Blog"><link rel="apple-touch-icon" href="/images/icons/icon-152x152.png"><!-- Add to home screen for Windows--><meta name="msapplication-TileImage" content="/images/icons/icon-152x152.png"><meta name="msapplication-TileColor" content="#000000"><title>Test Computed Properties and Watchers in Vue.js Components with Jest | Alex Jover Morales</title><meta name="description" content="Learn about testing the Computed Properties and Watchers reactivity in Vue.js."><meta name="twitter:title" content="Test Computed Properties and Watchers in Vue.js Components with Jest"><meta name="twitter:description" content="Learn about testing the Computed Properties and Watchers reactivity in Vue.js."><meta name="og:title" content="Test Computed Properties and Watchers in Vue.js Components with Jest"><meta name="og:description" content="Learn about testing the Computed Properties and Watchers reactivity in Vue.js."><meta name="article:author" content="https://www.facebook.com/alex.jovermorales"><meta name="article:published_time" content="2017-09-18T09:25:20.000Z"><meta name="article:modified_time" content="2017-09-18T09:25:20.000Z"><meta name="article:tag" content="VueJS"><meta name="article:tag" content="JavaScript"><meta name="article:tag" content="Testing"><meta name="twitter:card" content="summary"><meta name="og:image" content="http://alexjoverm.github.io/alex.jpg"><meta name="twitter:image" content="http://alexjoverm.github.io/alex.jpg"><meta name="twitter:site" content="@alexjoverm"><meta name="twitter:creator" content="@alexjoverm"><meta name="og:site_name" content="Alex Jover"><meta name="og:locale" content="en_EN"><meta name="og:type" content="article"><meta name="og:url" content="http://alexjoverm.github.io/2017/09/18/Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest/"><meta name="article:author" content="https://www.facebook.com/alex.jovermorales"><link rel="me" type="text/html" href="https://twitter.com/alexjoverm"><link rel="me" type="text/html" href="https://github.com/alexjoverm"><link rel="me" type="text/html" href="https://www.linkedin.com/in/alex-jover-morales-994752102/"><link rel="me" type="text/html" href="http://stackoverflow.com/users/4191146/alex-jm"><link rel="alternate" type="application/rss+xml" title="Alex Jover" href="/atom.xml"><link rel="preload" as="style" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="preload" as="style" href="/css/prism-okaidia.css"><link rel="preload" as="style" href="/css/bootstrap.min.css"><link rel="preload" as="style" href="/css/main.css"><link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/css/main.css"><link rel="preload" as="style" href="//fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700"><link rel="stylesheet" defer type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700"><meta property="algolia:search" data-application-id="6252178E0A" data-api-key="ead5c5a5a82108a54f04c9f610a54ee2" data-index-name="blog"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css"></head><body><div id="update-message">New content is available<button onclick="location.reload()" class="btn button-white">Reload</button></div><nav class="navbar navbar-default navbar-fixed-top navbar-custom top-nav-short"><div class="container"><div class="row"><div class="col-xs-12"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li class="search"><div id="search-box-container" class="search-box-container"><input id="search-box" type="search" placeholder="Search..." name="search" autocomplete="off" class="search-box"><svg viewbox="654 -372 1664 1664" class="search-box-icon"><path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z"></path></svg></div></li><li><a href="https://egghead.io/instructors/alex-jover-morales">Videos</a></li><li><a href="/series">Series</a></li><li><a href="/archives">Archive</a></li><li><a href="/about">About</a></li></ul></div></div></div></div></nav><div id="signup-form-modal"><form action="https://github.us16.list-manage.com/subscribe/post" method="POST" class="form signup-form"><input type="hidden" name="u" value="534e314884644825b957a5eee"><input type="hidden" name="id" value="e05e60374d"><div class="close-button">&times;</div><h4 class="text-center">Get upcoming Guides, Series, EBooks and Courses!</h4><div class="col-sm-4 fields"><label><input id="MERGE0" type="email" required placeholder="Your email" autocapitalize="off" autocorrect="off" name="MERGE0" class="form-control"></label></div><div class="col-sm-4 fields"><label><input id="MERGE1" type="text" name="MERGE1" placeholder="Your name" class="form-control"></label></div><div class="col-sm-4 fields"><button type="submit" class="button-white btn btn-block">Subscribe</button></div></form><div class="form-backdrop"></div></div><div class="container sidebar-layout"><div class="row"><div class="col-md-9 col-lg-9"><header class="header-section"><div class="intro-header no-img"><div class="post-heading"><h1>Test Computed Properties and Watchers in Vue.js Components with Jest</h1><p class="post-meta">Posted on Sep 18 2017 · <a href="/tags/VueJS/" class="tag post-meta">VueJS</a> · <a href="/tags/JavaScript/" class="tag post-meta">JavaScript</a> · <a href="/tags/Testing/" class="tag post-meta">Testing</a></p></div></div></header><main class="post-content"><div class="post-serie-container">
              <div class="post-serie">
                  <header>
                      <span class="serie-badge">Serie</span>
                      <a href="/series/Unit-Testing-Vue-js-Components-with-the-Official-Vue-Testing-Tools-and-Jest" alt="Unit Testing Vue.js Components with the Official Vue Testing Tools and Jest">
                          Unit Testing Vue.js Components with the Official Vue Testing Tools and Jest
                      </a>
                  </header>

                  <ol class="post-list">
                      
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/08/21/Write-the-first-Vue-js-Component-Unit-Test-in-Jest/" alt="Write the first Vue.js Component Unit Test in Jest">
                                      Write the first Vue.js Component Unit Test in Jest
                                  </a>
                              
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/08/28/Test-Deeply-Rendered-Vue-js-Components-in-Jest/" alt="Test Deeply Rendered Vue.js Components in Jest">
                                      Test Deeply Rendered Vue.js Components in Jest
                                  </a>
                              
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/09/04/Test-Styles-and-Structure-of-Vue-js-Components-in-Jest/" alt="Test Styles and Structure of Vue.js Components in Jest">
                                      Test Styles and Structure of Vue.js Components in Jest
                                  </a>
                              
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/09/11/Test-Properties-and-Custom-Events-in-Vue-js-Components-with-Jest/" alt="Test Properties and Custom Events in Vue.js Components with Jest">
                                      Test Properties and Custom Events in Vue.js Components with Jest
                                  </a>
                              
                          </li>
                          <li class="current">
                              Test Computed Properties and Watchers in Vue.js Components with Jest
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/09/25/Test-Methods-and-Mock-Dependencies-in-Vue-js-with-Jest/" alt="Test Methods and Mock Dependencies in Vue.js with Jest">
                                      Test Methods and Mock Dependencies in Vue.js with Jest
                                  </a>
                              
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/10/02/Test-Vue-js-Slots-in-Jest/" alt="Test Vue.js Slots in Jest">
                                      Test Vue.js Slots in Jest
                                  </a>
                              
                          </li>
                          <li false>
                              
                                  <a href="http://alexjoverm.github.io/2017/10/07/Enhance-Jest-configuration-with-Module-Aliases/" alt="Enhance Jest configuration with Module Aliases">
                                      Enhance Jest configuration with Module Aliases
                                  </a>
                              
                          </li>
                  </ol>
              </div>
          </div><article role="main" class="blog-post"><p>Learn about testing Computed Properties and Watchers reactivity in Vue.js.</p>
<a id="more"></a>
<p>Computed properties and watchers are reactive parts of the logic of Vue.js components. They both serve totally different purposes, one is synchronous and the other asynchronous, which makes them behave slightly different.</p>
<p>In this article we’ll go through testing them and see what different cases we can find on the way.</p>
<h2 id="Computed-Properties"><a href="#Computed-Properties" class="headerlink" title="Computed Properties"></a>Computed Properties</h2><p>Computed properties are simple reactive functions that return data in another form. They behave exactly like the language standard <code>get/set</code> properties:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">get</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>surname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">set</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In fact, when you’re building class based Vue components, as I explain in my <a href="https://egghead.io/courses/use-typescript-to-develop-vue-js-web-applications" target="_blank" rel="external">Egghead course “Use TypeScript to Develop Vue.js Web Applications”</a>, you’ll write it just like that. If you’re using plain objects, it’d be:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>surname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And you can even add the <code>set</code> as follows:</p>
<pre class=" language-javascript"><code class="language-javascript">computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    fullName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>surname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre>
<h3 id="Testing-Computed-Properties"><a href="#Testing-Computed-Properties" class="headerlink" title="Testing Computed Properties"></a>Testing Computed Properties</h3><p>Testing a computed property is very simple, and probably sometimes you don’t test a computed property exclusively, but test it as part of other tests. But most times it’s good to have a test for it, whether that computed property is cleaning up an input, or combining data, we wanna make sure things work as intended. So let’s begin.</p>
<p>First of all, create a <code>Form.vue</code> component:</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputValue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reversed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ reversedInput }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>
export default {
  props: ['reversed'],
  data: () => ({
    inputValue: ''
  }),
  computed: {
    reversedInput() {
      return this.reversed ?
        this.inputValue.split("").reverse().join("") :
        this.inputValue
    }
  }
}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
<p>It will show an input, and next to it the same string but reversed. It’s just a silly example, but enough to test it.</p>
<p>Now add it to <code>App.vue</code>, put it after the <code>MessageList</code> component, and remember to import it and include it within the <code>components</code> component option. Then, create a <code>test/Form.test.js</code> with the usual bare-bones we’ve used in other tests:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> shallow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-test-utils'</span>
<span class="token keyword">import</span> Form <span class="token keyword">from</span> <span class="token string">'../src/components/Form'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Form.test.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cmp

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    cmp <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Now create a test suite with 2 test cases:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Properties'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'returns the string in normal order if reversed property is not true'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'Yoo'</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>reversedInput<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Yoo'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'returns the reversed string if reversed property is true'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'Yoo'</span>
    cmp<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> reversed<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>reversedInput<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'ooY'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>We can access the component instance within <code>cmp.vm</code>, so we can access the internal state, computed properties and methods. Then, to test it is just about changing the value and making sure it returns the same string when reversed is false.</p>
<p>For the second case, it would be almost the same, with the difference that we must set the <code>reversed</code> property to true. We could navigate through <code>cmp.vm...</code> to change it, but vue-test-utils give us a helper method <code>setProps({ property: value, ... })</code> that makes it very easy.</p>
<p>That’s it, depending on the computed property it may need more test cases.</p>
<h2 id="Watchers"><a href="#Watchers" class="headerlink" title="Watchers"></a>Watchers</h2><p>Honestly, I haven’t come across any case where I really need to use watchers that I computed properties couldn’t solve. I’ve seen them misused as well, leading to a very unclear data workflow among components and messing everything up, so don’t rush on using them and think beforehand.</p>
<p>As you can see in the <a href="https://vuejs.org/v2/guide/computed.html#Watchers" target="_blank" rel="external">Vue.js docs</a>, watchers are often used to react to data changes and perform asynchronous operations, such can be performing an ajax request.</p>
<h3 id="Testing-Watchers"><a href="#Testing-Watchers" class="headerlink" title="Testing Watchers"></a>Testing Watchers</h3><p>Let’s say we wanna do something when the <code>inputValue</code> from the state change. We could do an ajax request, but since that’s more complicated and we’ll see it in the next lesson, let’s just do a <code>console.log</code>. Add a <code>watch</code> property to the <code>Form.vue</code> component options:</p>
<pre class=" language-javascript"><code class="language-javascript">watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">inputValue</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>newVal<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!==</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Notice the <code>inputValue</code> watch function matches the state variable name. By convention, Vue will look it up in both <code>properties</code> and <code>data</code> state by using the watch function name, in this case <code>inputValue</code>, and since it will find it in <code>data</code>, it will add the watcher there.</p>
<p>See that a watch function takes the new value as a first parameter, and the old one as the second. In this case we’ve chosen to log only when it’s not empty and the values are different. Usually, we’d like to write a test for each case, depending on the time you have and how critical that code is.</p>
<p>What should we test about the watch function? Well, that’s something we’ll also discuss further in the next lesson when we talk about testing methods, but let’s say we just wanna know that it calls the <code>console.log</code> when it should. So, let’s add the bare bones of the watchers test suite, within <code>Form.test.js</code>:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Form.test.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cmp
  <span class="token operator">...</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Watchers - inputValue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> spy

    <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      spy<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is not called if value is empty (trimmed)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is not called if values are the same'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is called with the new value in other cases'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>We’re using a spy on the <code>console.log</code> method, initializing before starting any test, and resetting its state after each of them, so that they start from a clean spy.</p>
<p>To test a watch function, we just need to change the value of what’s being watch, in this case the <code>inputValue</code> state. But there is something curious… let’s start by the last test</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is called with the new value in other cases'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>We change the <code>inputValue</code>, so the <code>console.log</code> spy should be called, right? Well, if you run it, you’ll notice that is not! WTF??? Wait, there is an explanation for this: unlike computed properties, watchers are <strong>deferred to the next update cycle</strong> that Vue uses to look for changes. So, basically, what’s happening here is that <code>console.log</code> is indeed called, but after the test has finished.</p>
<p>To solve this, we need to use the <a href="https://vuejs.org/v2/api/#vm-nextTick" target="_blank" rel="external"><code>vm.$nextTick</code></a> function to defer code to the next update cycle. But if we write:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is called with the new value in other cases'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>It will still fail, since the test finishes with the <code>expect</code> function not being called. That happens because now is asynchronous and happens on the <code>$nextTick</code> callback. How can we then test it if the expect happens at a later time?</p>
<p>Jest give us a <code>next</code> parameter that we can use in the <code>it</code> test callbacks, in a way that if it is present, the test will not finish until <code>next</code> is called, but if it’s not, it will finish synchronously. So, to finally get it right:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is called with the new value in other cases'</span><span class="token punctuation">,</span> next <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>We can apply the same strategy for the other two, with the difference that the spy shouldn’t be called:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is not called if value is empty (trimmed)'</span><span class="token punctuation">,</span> next <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'   '</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is not called if values are the same'</span><span class="token punctuation">,</span> next <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>

  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    spy<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>

    cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>That second one gets a bit more complex than it looked like. The default internal state is empty, so first we need to change it, wait for the next tick, then clear the mock to reset the call count, and change it again. Then after the second tick, we can check the spy and finish the test.</p>
<p>This can get simpler if we recreate the component at the beginning, overriding the <code>data</code> property. Remember we can override any component option by using the second parameter of the <code>mount</code> or <code>shallow</code> functions:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'is not called if values are the same'</span><span class="token punctuation">,</span> next <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  cmp <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span>Form<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> inputValue<span class="token punctuation">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">'foo'</span>

  cmp<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>You’ve learned in this article how to test part of the logic of Vue components: computed properties and watchers. We’ve gone through different test cases we can come across testing them. Probably you’ve also learned some of the Vue internals such as the <code>nextTick</code> update cycles.</p>
<p>You can find the code of this article <a href="https://github.com/alexjoverm/vue-testing-series/tree/Test-State-Computed-Properties-and-Methods-in-Vue-js-Components-with-Jest" target="_blank" rel="external">in this repo</a>.</p>

    <p><a class="twitter-share-button"
  href="https://twitter.com/intent/tweet?text=Test%20Computed%20Properties%20and%20Watchers%20in%20Vue.js%20Components%20with%20Jest&url=http://alexjoverm.github.io/2017/09/18/Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest/&hashtags=VueJS%2CJavaScript%2CTesting&via=alexjoverm">Tweet</a></p>

    <p>If you like it, please go and share it!
    You can follow me <a href="https://egghead.io/instructors/alex-jover-morales">recording videos on Egghead</a>
    or on twitter as <a href="https://twitter.com/alexjoverm">@alexjoverm</a>. Any questions? Shoot!</p>
  </article><ul class="pager blog-pager"><li class="previous"><a href="/2017/09/25/Test-Methods-and-Mock-Dependencies-in-Vue-js-with-Jest/" data-toggle="tooltip" data-placement="top" title="Test Methods and Mock Dependencies in Vue.js with Jest">← Previous Post</a></li><li class="next"><a href="/2017/09/11/Test-Properties-and-Custom-Events-in-Vue-js-Components-with-Jest/" data-toggle="tooltip" data-placement="top" title="Test Properties and Custom Events in Vue.js Components with Jest">Next Post →</a></li></ul></main></div><div class="main-sidebar col-md-3 col-lg-3"><div class="sidebar-item"><header class="sidebar-item-header"><h4>New Ebook!</h4></header><div class="sidebar-item-content"><strong class="preface">Consider supporting this blog by buying the ebook</strong><a href="https://leanpub.com/testingvuejscomponentswithjest" target="_blank" onclick="ga('send', 'event', 'Book', 'click', 'Testing Vue.js components with Jest');"><img data-src="/images/vuejest.jpg" alt="Testing Vue.js components with Jest" class="v-padding-xs">Testing Vue.js components with Jest</a></div></div><div class="sidebar-item"><header class="sidebar-item-header"><h4>Courses</h4></header><div class="sidebar-item-content"><div class="course-item"><a href="https://egghead.io/courses/use-typescript-to-develop-vue-js-web-applications" target="_blank" onclick="ga('send', 'event', 'Course', 'click', 'Use Typescript to develop Vue.js web applications - Egghead');"><img data-src="/images/courses/vuets.png" alt="Use Typescript to develop Vue.js web applications">Use TypeScript to Develop Vue.js Web Applications</a></div><hr><div class="course-item"><a href="https://egghead.io/courses/vue-js-state-management-with-vuex-and-typescript" target="_blank" onclick="ga('send', 'event', 'Course', 'click', 'Vue.js state management with Vuex and TypeScript course - Egghead');"><img data-src="/images/courses/vuexts.png" alt="Vue.js state management with Vuex and TypeScript course">Vue.js State Management with Vuex and TypeScript</a></div></div></div></div></div><div class="row"><div id="signup-form-footer"><form action="https://github.us16.list-manage.com/subscribe/post" method="POST" class="form signup-form"><input type="hidden" name="u" value="534e314884644825b957a5eee"><input type="hidden" name="id" value="e05e60374d"><div class="close-button">&times;</div><h4 class="text-center">Get upcoming Guides, Series, EBooks and Courses!</h4><div class="col-sm-4 fields"><label><input id="MERGE0" type="email" required placeholder="Your email" autocapitalize="off" autocorrect="off" name="MERGE0" class="form-control"></label></div><div class="col-sm-4 fields"><label><input id="MERGE1" type="text" name="MERGE1" placeholder="Your name" class="form-control"></label></div><div class="col-sm-4 fields"><button type="submit" class="button-white btn btn-block">Subscribe</button></div></form></div><div class="disqus-comments"><div class="comments"><div id="disqus_thread"></div></div></div><script>var url_parts = window.location.href.split("?");
var disqus_url = url_parts[0];
(function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = "//alexjm-blog.disqus.com/embed.js";
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><p class="copyright text-muted">© Alex Jover Morales • 2018</p></div></div></footer><script>window.lazyLoadOptions = {};
</script><script src="/js/sw-register.js"></script><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script async src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/8.7.1/lazyload.min.js"></script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script><script>var algoliaConfig = document.querySelector('meta[property="algolia:search"]').dataset

// Initialize autocomplete menu
var client = algoliasearch(algoliaConfig.applicationId, algoliaConfig.apiKey)
var index = client.initIndex(algoliaConfig.indexName)
//initialize autocomplete on search input (ID selector must match)
autocomplete('#search-box', { hint: false, appendTo: 'body', debug: true }, {
  source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
  //value to be displayed in input control after user's suggestion selection
  displayKey: 'name',
  //hash of templates used when rendering dataset
  templates: {
    //'suggestion' templating function used to render a single suggestion
    suggestion: function(suggestion) {
      let link = '<a href="'+ suggestion.permalink +'">' +
        suggestion._highlightResult.title.value + '</a>'

        // @Todo: add <span> with type before the link
        return link
      },
      footer: '<div class="branding">Powered by <img src="https://www.algolia.com/static_assets/images/press/downloads/algolia-logo-light.svg" /></div>'
    }
})
</script><script>window.twttr = (function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0],
t = window.twttr || {};
if (d.getElementById(id)) return t;
js = d.createElement(s);
js.id = id;
js.src = "https://platform.twitter.com/widgets.js";
fjs.parentNode.insertBefore(js, fjs);
t._e = [];
t.ready = function(f) {
t._e.push(f);
};
return t;
}(document, "script", "twitter-wjs"));

</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-93226517-1', 'auto');
ga('send', 'pageview');</script></body></html>